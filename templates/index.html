{% extends 'base.html' %}

{% block title %}Início - Social Evolutions{% endblock %}

{% block content %}
  <form method="get" action="{{ url_for('index') }}" style="margin-bottom: 30px; display: flex; justify-content: center; align-items: center; gap: 10px; flex-wrap: wrap;">
    <input type="text" name="busca" placeholder="Buscar produto..." value="{{ busca }}" style="padding: 10px; width: 60%; max-width: 400px; border-radius: 8px; border: 1px solid #ccc;">
    <button type="submit" class="botao" style="padding: 10px 20px;">Buscar</button>
  </form>

  
{% for categoria, produtos in categorias.items() %}
  <div class="categoria" data-categoria="{{ categoria }}">
    <h2 class="titulo-categoria">{% if categoria == "Novos Produtos" %}⭐ {% endif %}{{ categoria }}</h2>
    <div class="produtos-grid">
      {% for p in produtos %}
        <div class="produto {% if categoria == 'Novos Produtos' and loop.index0 == 0 %}destaque-novidade{% endif %}">
          <a href="{{ url_for('detalhes', produto_id=p.id) }}">
            <img src="{{ url_for('static', filename='img/produtos/' + p.imagem) }}" alt="{{ p.nome }}">
          </a>
          
          <!-- Botão Conferir no canto da imagem -->
         
          <button class="botao-conferir-img" onclick="window.location.href='{{ url_for('detalhes', produto_id=p.id) }}'">Conferir</button>
          <h3 style="color: #0c110e;">{{ p.nome }} — R$ {{ p.preco }}</h3>
          <div class="botao-container">
            
            <button onclick="comprarMercadoPago({{ p.id }})" class="botao" id="btn-mp-{{ p.id }}">COMPRAR COM MERCADO PAGO</button>
            <a class="botao" href="https://wa.me/+5519996812116?text=Olá, quero comprar: {{ p.nome }} por R${{ p.preco }}" target="_blank">Comprar no WhatsApp</a>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
{% endfor %}
<!-- SDK do Mercado Pago (coloque no <head> ou antes do </body>) -->
<script src="https://sdk.mercadopago.com/js/v2"></script>

<script>
  function comprarMercadoPago(produtoId) {
    fetch("/create_preference", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ produto_id: produtoId })
    })
    .then(response => response.json())
    .then(data => {
      if (data.init_point) {
        window.location.href = data.init_point; // redireciona para o Checkout Pro
      } else {
        alert("Erro ao criar link de pagamento");
      }
    })
    .catch(error => {
      console.error("Erro na requisição:", error);
      alert("Erro ao criar preferência");
    });
  }
</script>

{% endblock %}